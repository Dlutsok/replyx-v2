# Детальные UX сценарии: Страница управления AI-токенами

## 🎯 Контекст пользовательского опыта

**Целевая аудитория**: Системные администраторы ChatAI  
**Частота использования**: Ежедневно для мониторинга, еженедельно для настройки  
**Ключевые задачи**: Отслеживание использования токенов, управление лимитами, обеспечение отказоустойчивости

---

## 🏃‍♂️ 1. СЦЕНАРИЙ: Администратор просматривает список токенов

### 🎬 Базовый flow:
1. **Переход на страницу**: Клик "AI Токены" в sidebar админ-панели
2. **Загрузка данных**: Система показывает loading spinner + "Загрузка AI токенов..."
3. **Отображение данных**: Таблица с токенами, статистическими карточками, фильтрами

### 📊 Информационная архитектура:

#### A. Quick Stats Cards (4 карточки в ряд)
```
┌─[Активных токенов]─┬─[Дневное использование]─┬─[Месячное использование]─┬─[Токены с ошибками]─┐
│ 🔥 3/5             │ 📈 45%                   │ 📅 67%                    │ ⚠️  2                │
│ +1 за неделю       │ ████████░░░░ 45%         │ ████████████░ 67%         │ Требуют внимания     │
└────────────────────┴──────────────────────────┴───────────────────────────┴─────────────────────┘
```

#### B. Основная таблица с приоритизированной информацией:
**Порядок колонок** (по важности для быстрого сканирования):
1. **Статус** - мгновенная визуальная индикация
2. **Название + Приоритет** - идентификация токена
3. **Модели** - технические характеристики  
4. **Дневное использование** - критичная текущая метрика
5. **Месячное использование** - долгосрочная метрика
6. **Последняя активность** - актуальность токена
7. **Ошибки** - проблемы требующие внимания
8. **Действия** - возможные операции

### 🎨 Визуальные паттерны восприятия:

#### Цветовое кодирование использования:
- **0-69%**: `#22c55e` (зеленый) - "Все в порядке"
- **70-89%**: `#f59e0b` (желтый) - "Внимание требуется"  
- **90-100%**: `#ef4444` (красный) - "Критическое состояние"

#### Статусы токенов:
- **● Активен**: зеленая точка + "Активен"
- **● Неактивен**: серая точка + "Неактивен"  
- **● Ошибка**: красная точка + "Ошибка"

### ⚡ Интерактивные элементы:

#### Hover эффекты:
- **Строка таблицы**: легкое затемнение фона `#f9f9f9`
- **Кнопки действий**: увеличение иконки на 10%, изменение цвета
- **Progress bar**: показать точное числовое значение в tooltip

#### Клик взаимодействия:
- **Название токена**: открыть модальное окно редактирования
- **Progress bar**: открыть детальную статистику  
- **Маскированный токен**: временно показать полный токен (3 секунды)

---

## ➕ 2. СЦЕНАРИЙ: Администратор создает новый AI токен

### 🎬 Детальный flow:

#### Шаг 1: Инициация создания
```
[Кнопка "Добавить токен"] → Модальное окно "Новый AI токен"
```

#### Шаг 2: Заполнение формы (модальное окно 600px ширина)
```html
┌─[Новый AI токен]──────────────────────────────────────────┐
│ ✕                                                         │
│                                                           │
│ Название токена *                                         │  
│ ┌─────────────────────────────────────────────────────┐   │
│ │ Production Main                                     │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                           │
│ OpenAI API ключ *                                         │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ sk-.................................... [👁]        │   │
│ └─────────────────────────────────────────────────────┘   │
│ ⚠️  Ключ будет зашифрован и безопасно сохранен            │
│                                                           │
│ Доступные модели *                                        │
│ ┌─ GPT-4O ─────── GPT-4O-Mini ─── GPT-3.5-Turbo ──┐      │
│ │  ☑️ Выбрано       ☑️ Выбрано      ☐ Не выбрано   │      │
│ └──────────────────────────────────────────────────┘      │
│                                                           │
│ Лимиты использования                                       │
│ Дневной лимит        │ Месячный лимит                     │
│ ┌─────────────────┐  │ ┌─────────────────┐               │
│ │ 10000          │  │ │ 300000         │               │
│ └─────────────────┘  │ └─────────────────┘               │
│                                                           │
│ Приоритет (1 = высший)                                    │
│ ┌──1──┬──2──┬──3──┬──4──┬──5──┬──6──┬──7──┬──8──┬──9──┬──10─┐
│ │ ● │ ○ │ ○ │ ○ │ ○ │ ○ │ ○ │ ○ │ ○ │ ○ │
│ └────┴────┴────┴────┴────┴────┴────┴────┴────┴─────┘
│                                                           │
│ Заметки (опционально)                                     │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ Основной production токен для высоконагруженных...  │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                           │
│              [Отмена]    [Создать токен]                  │
└───────────────────────────────────────────────────────────┘
```

#### Шаг 3: Валидация в реальном времени
**Поля с валидацией:**
- **Название**: уникальность, мин. 3 символа
- **API ключ**: формат `sk-...`, длина 51 символ
- **Лимиты**: числовые значения > 0
- **Модели**: минимум одна модель должна быть выбрана

#### Шаг 4: Обратная связь и результат
```
✅ Success: "Токен 'Production Main' успешно создан и активирован"
❌ Error: "Ошибка: токен с таким названием уже существует"
⏳ Loading: "Проверка токена и создание..." (анимированный spinner)
```

### 🎛️ Micro-interactions:

#### Поле API ключа:
- **Состояние**: маскированный по умолчанию `sk-...................................`
- **Toggle видимости**: кнопка 👁 показать/скрыть полный ключ
- **Валидация**: подсветка красным при неверном формате
- **Копирование**: двойной клик = автокопирование в буфер

#### Выбор моделей:
- **Визуализация**: карточки с чекбоксами
- **Состояния**: выбрано (синий), не выбрано (серый), недоступно (заблокирован)
- **Подсказки**: hover показывает описание возможностей модели

#### Слайдер приоритета:
- **Визуализация**: числовая шкала 1-10 с точками
- **Интерактивность**: клик по числу или перетаскивание
- **Подсказка**: "1 = максимальный приоритет, используется первым"

---

## ✏️ 3. СЦЕНАРИЙ: Администратор редактирует существующий токен

### 🎬 Детальный flow:

#### Способы открытия редактирования:
1. **Клик по названию токена** в таблице
2. **Клик на иконку ✏️** в колонке "Действия"  
3. **Двойной клик** на любом месте строки токена

#### Модальное окно редактирования:
```html
┌─[Редактировать токен: Production Main]────────────────────┐
│ ✕                                                         │
│                                                           │
│ 📊 Статистика токена                                       │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ Создан: 15.01.2025  •  Использован: 2 мин. назад    │   │
│ │ Всего запросов: 45,672  •  Успешных: 99.2%         │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                           │
│ Название токена                                           │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ Production Main                                     │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                           │
│ 🔒 OpenAI API ключ                                        │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ sk-...7f2g                            [Заменить]   │   │
│ └─────────────────────────────────────────────────────┘   │
│ ℹ️  По соображениям безопасности ключ не отображается     │
│                                                           │
│ Статус токена                                             │
│ ┌── ● Активен ──┬── ○ Неактивен ──┐                       │
│ │  Используется │  Отключен      │                       │
│ └───────────────┴─────────────────┘                       │
│                                                           │
│ Доступные модели                                          │
│ [Аналогично созданию]                                      │
│                                                           │
│ Лимиты использования                                       │
│ [Аналогично созданию с текущими значениями]                │
│                                                           │
│ Заметки                                                   │
│ [Текстовое поле с существующими заметками]                 │
│                                                           │
│          [Отмена]    [Сохранить изменения]                │
└───────────────────────────────────────────────────────────┘
```

### 🔄 Специальные возможности редактирования:

#### Замена API ключа:
- **Кнопка "Заменить"**: открывает дополнительное поле ввода
- **Подтверждение**: "Вы уверены? Старый ключ будет удален"
- **Валидация**: проверка нового ключа перед сохранением

#### Изменение статуса:
- **Деактивация**: предупреждение "Токен перестанет обрабатывать запросы"
- **Активация**: проверка лимитов и доступности моделей

#### Bulk операции (когда выбрано несколько токенов):
```
Выбрано: 3 токена
[Активировать все] [Деактивировать все] [Изменить приоритеты] [Удалить выбранные]
```

---

## 📈 4. СЦЕНАРИЙ: Администратор просматривает статистику использования токена

### 🎬 Детальный flow:

#### Способы открытия статистики:
1. **Клик по progress bar** использования в таблице
2. **Клик на иконку 📊** в колонке "Действия"
3. **Клик по процентному значению** использования

#### Модальное окно статистики (ширина 800px):
```html
┌─[Статистика токена: Production Main]──────────────────────┐
│ ✕                                                 [📤 Экспорт] │
│                                                           │
│ 📊 Общая статистика за последние 30 дней                  │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ Всего запросов: 45,672  •  Успешных: 99.2%         │   │
│ │ Среднее время ответа: 1.2с  •  Ошибок: 347         │   │
│ │ Пиковая нагрузка: 2,543 запроса/день               │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                           │
│ 📈 График использования по дням                            │
│ ┌─────────────────────────────────────────────────────┐   │
│ │     ▁▃▇█▅▆▃▁▄▇█▃▁▄▆▇▁▃▅▇█▄▂▁▃▅▇█▃▁▄▅▇              │   │
│ │  0 ├─────────────────────────────────────────────┤ 3k │   │
│ │    15.01  20.01  25.01  30.01  5.02  10.02        │   │
│ └─────────────────────────────────────────────────────┘   │
│ 🕐 Hover: "25.01.2025 - 2,543 запроса, успешно: 99.8%"   │
│                                                           │
│ 🎯 Распределение по моделям                               │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ GPT-4O:        ████████████████████░ 80% (36,538)   │   │
│ │ GPT-4O-Mini:   ████████░░░░░░░░░░░░ 20% (9,134)    │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                           │
│ 🕒 Активность по часам (среднее за 30 дней)               │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ 06:00 ▃▅▇█▇▅▃▂▁▂▃▅▇█▇▅▃▂▁▂▃▅▇█ 22:00              │   │
│ │       └─ Пик: 14:00-16:00 (рабочие часы) ─┘        │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                           │
│ 🚨 Последние ошибки (5 из 347)                           │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ 25.01 14:30 - Rate limit exceeded (429)            │   │
│ │ 25.01 13:45 - Invalid model specified (400)        │   │
│ │ 24.01 16:20 - Timeout error (408)                  │   │
│ │ [...показать все]                                   │   │
│ └─────────────────────────────────────────────────────┘   │
│                                                           │
│                              [Закрыть]                   │
└───────────────────────────────────────────────────────────┘
```

### 📊 Интерактивная аналитика:

#### График использования:
- **Hover**: показать детали дня в tooltip
- **Клик**: перейти к детальному просмотру дня
- **Зум**: колесико мыши для масштабирования временного периода

#### Фильтры периода:
```
[7 дней] [30 дней] [90 дней] [Выбрать период...]
```

#### Экспорт данных:
- **CSV**: сырые данные статистики
- **PDF**: красивый отчет с графиками
- **JSON**: машиночитаемый формат

---

## 🗑️ 5. СЦЕНАРИЙ: Администратор удаляет токен

### 🎬 Детальный flow безопасного удаления:

#### Шаг 1: Инициация удаления
**Способы**: клик на иконку 🗑️ в таблице

#### Шаг 2: Проверка использования
```javascript
// Система проверяет:
- активные запросы с этим токеном
- использование за последние 24 часа  
- зависимые сервисы
```

#### Шаг 3: Подтверждающий диалог
```html
┌─[⚠️ Подтвердите удаление]──────────────────────────────────┐
│                                                           │
│ Вы собираетесь удалить AI токен "Production Main"         │
│                                                           │
│ ⚠️  ВНИМАНИЕ: Это действие необратимо!                     │
│                                                           │
│ 📊 Состояние токена:                                       │
│ • Статус: Активен                                         │
│ • Использование за сегодня: 2,543 запроса                 │
│ • Приоритет: 1 (высокий)                                  │
│ • Последняя активность: 2 минуты назад                    │
│                                                           │
│ ⚡ Возможные последствия:                                  │
│ • Снижение общей пропускной способности системы           │
│ • Увеличение нагрузки на оставшиеся токены                │
│ • Возможные временные сбои в обработке запросов           │
│                                                           │
│ Для подтверждения введите название токена:                │
│ ┌─────────────────────────────────────────────────────┐   │
│ │ Production Main                                     │   │
│ └─────────────────────────────────────────────────────┘   │
│ ✅ Название введено верно                                  │
│                                                           │
│              [Отмена]    [🗑️ Удалить токен]               │
└───────────────────────────────────────────────────────────┘
```

#### Шаг 4: Процесс удаления и обратная связь
```
⏳ "Удаление токена и обновление конфигурации..." (3-5 сек)
✅ "Токен 'Production Main' успешно удален" 
📈 "Автоматически повышен приоритет токена 'Backup Token'"
```

### ⛔ Защитные механизмы:

#### Блокировка удаления критических токенов:
- **Последний активный токен**: нельзя удалить
- **Токен с высокой нагрузкой**: дополнительные предупреждения
- **Административные токены**: требуют супер-админ права

#### Альтернативные действия:
```
❔ Вместо удаления рассмотрите:
   [Деактивировать токен] [Снизить приоритет] [Отменить]
```

---

## 🚨 6. СЦЕНАРИЙ: Обработка ошибок и loading states

### ⏳ Loading States:

#### A. Загрузка списка токенов (первичная загрузка):
```html
<div class="loadingContainer">
  <div class="spinner"></div>
  <h3>Загрузка AI токенов...</h3>
  <p>Получение данных о пуле токенов и статистике использования</p>
</div>
```

#### B. Обновление данных (автообновление каждые 30 сек):
```html
<!-- Тонкий индикатор в header -->
<div class="refreshIndicator">
  <div class="progressLine"></div>
  <span>Обновление через 15 сек...</span>
</div>
```

#### C. Создание/редактирование токена:
```html
<!-- Блокировка модальной формы -->
<div class="modalLoading">
  <div class="overlay"></div>
  <div class="loadingContent">
    <div class="spinner"></div>
    <p>Сохранение конфигурации токена...</p>
  </div>
</div>
```

### ❌ Error States и Recovery:

#### A. Ошибка загрузки данных:
```html
<div class="errorState">
  <div class="errorIcon">🚨</div>
  <h3>Не удалось загрузить токены</h3>
  <p>Проверьте подключение к серверу и попробуйте еще раз</p>
  <div class="errorActions">
    <button class="retryBtn primary">🔄 Повторить</button>
    <button class="debugBtn secondary">📋 Показать детали</button>
  </div>
</div>
```

#### B. Ошибки валидации формы:
```javascript
// Real-time валидация с подсветкой полей
{
  "name": {
    "error": "Название должно содержать минимум 3 символа",
    "valid": false
  },
  "token": {
    "error": "Неверный формат OpenAI ключа",
    "valid": false  
  }
}
```

#### C. Сетевые ошибки с автовосстановлением:
```html
<div class="networkErrorBanner">
  ⚠️ Потеряно соединение с сервером. 
  Переподключение через <span class="countdown">5</span> сек...
  <button class="reconnectNow">Подключиться сейчас</button>
</div>
```

### 🔄 Auto-recovery паттерны:

#### Exponential backoff для повторных запросов:
```javascript
const retryIntervals = [1000, 2000, 5000, 10000, 30000]; // мс
```

#### Оффлайн режим:
```html
<div class="offlineMode">
  📡 Работа в оффлайн режиме. 
  Показаны данные от <span class="lastUpdate">14:25</span>
</div>
```

---

## 🔍 7. СЦЕНАРИЙ: Фильтрация и поиск по токенам

### 🎯 Поисковые возможности:

#### A. Быстрый поиск (live search):
```html
<div class="searchBox">
  <input 
    placeholder="Поиск по названию, модели или заметкам..." 
    type="text"
    class="searchInput"
  />
  <div class="searchResults">
    Найдено: 3 из 15 токенов
    <button class="clearSearch">✕ Очистить</button>
  </div>
</div>
```

#### B. Расширенные фильтры:
```html
<div class="advancedFilters">
  <!-- Статус -->
  <select class="filter">
    <option>Все статусы</option>
    <option>Активные (3)</option>
    <option>Неактивные (2)</option>
    <option>С ошибками (1)</option>
  </select>
  
  <!-- Приоритет -->
  <select class="filter">
    <option>Все приоритеты</option>
    <option>Высокий (1-3)</option>
    <option>Средний (4-6)</option>
    <option>Низкий (7-10)</option>
  </select>
  
  <!-- Использование -->
  <select class="filter">
    <option>Любое использование</option>
    <option>Высокое (>80%)</option>
    <option>Среднее (50-80%)</option>
    <option>Низкое (<50%)</option>
  </select>
  
  <!-- Модели -->
  <select class="filter">
    <option>Все модели</option>
    <option>GPT-4O</option>
    <option>GPT-4O-Mini</option>
    <option>GPT-3.5-Turbo</option>
  </select>
</div>
```

### 📊 Сортировка и группировка:

#### Быстрые сортировки:
```html
<div class="quickSort">
  <button class="sortBtn active">По приоритету ↓</button>
  <button class="sortBtn">По использованию ↓</button>
  <button class="sortBtn">По названию ↑</button>
  <button class="sortBtn">По активности ↓</button>
</div>
```

#### Группировка токенов:
```html
<!-- Группировка по статусу -->
<div class="tokenGroups">
  <div class="tokenGroup">
    <h4>🟢 Активные токены (3)</h4>
    [Таблица активных токенов]
  </div>
  
  <div class="tokenGroup">
    <h4>🔴 Токены с проблемами (2)</h4>  
    [Таблица проблемных токенов]
  </div>
  
  <div class="tokenGroup collapsed">
    <h4>⚪ Неактивные токены (2) [показать]</h4>
  </div>
</div>
```

### 🔖 Сохранение поисковых запросов:

#### Быстрые фильтры (preset):
```html
<div class="savedFilters">
  <button class="filterPreset">🚨 Требуют внимания</button>
  <button class="filterPreset">⚡ Высокая нагрузка</button>
  <button class="filterPreset">💤 Неиспользуемые</button>
  <button class="filterPreset">➕ Создать фильтр</button>
</div>
```

---

## 📱 8. АДАПТИВНОСТЬ И ACCESSIBILITY

### 📱 Мобильная адаптация (768px и меньше):

#### Трансформация таблицы в карточки:
```html
<div class="tokenCard mobile">
  <div class="cardHeader">
    <div class="statusBadge active">● Активен</div>
    <div class="priorityBadge">П1</div>
  </div>
  
  <h4 class="tokenName">Production Main</h4>
  <div class="tokenMeta">sk-...7f2g • GPT-4O, GPT-4O-Mini</div>
  
  <div class="usageMetrics">
    <div class="usageItem">
      <span>Дневное:</span>
      <div class="progressMini">██████░░ 75%</div>
    </div>
    <div class="usageItem">  
      <span>Месячное:</span>
      <div class="progressMini">████░░░░ 45%</div>
    </div>
  </div>
  
  <div class="cardActions">
    <button>📊</button>
    <button>✏️</button>
    <button>🗑️</button>
  </div>
</div>
```

### ♿ Accessibility требования:

#### Keyboard Navigation:
- **Tab**: переход между элементами
- **Enter/Space**: активация кнопок и ссылок
- **Escape**: закрытие модальных окон
- **Arrow keys**: навигация по таблице

#### Screen Reader поддержка:
```html
<table role="table" aria-label="AI токены">
  <tr role="row">
    <td role="cell" aria-label="Статус: активен">
      <div class="statusCell">
        <div class="statusDot active" aria-hidden="true"></div>
        <span>Активен</span>
      </div>
    </td>
    <td role="cell" aria-label="Использование 75% от дневного лимита">
      <div class="usageCell">
        <div class="progressBar" role="progressbar" 
             aria-valuemin="0" aria-valuemax="100" aria-valuenow="75">
          <div class="progressFill" style="width: 75%"></div>
        </div>
      </div>
    </td>
  </tr>
</table>
```

#### Цветовые контрасты (WCAG AA):
- **Текст на белом**: минимум 4.5:1
- **Иконки статуса**: дополнение текстовыми метками
- **Progress bars**: числовые значения дублируют цвета

---

## ⚡ 9. PERFORMANCE И ОПТИМИЗАЦИЯ UX

### 🚀 Быстродействие интерфейса:

#### Виртуализация для больших списков:
```javascript
// Рендерить только видимые строки при >50 токенов
const VirtualizedTable = {
  visibleRows: 20,
  bufferRows: 5,
  totalRows: tokensCount
}
```

#### Оптимистичные обновления:
```javascript
// Мгновенное обновление UI, откат при ошибке
const optimisticUpdate = (tokenId, newStatus) => {
  updateUIImmediately(tokenId, newStatus);
  
  apiCall(tokenId, newStatus)
    .catch(() => revertUIUpdate(tokenId));
}
```

#### Lazy loading модальных окон:
```javascript
// Загружать статистику только при открытии модального окна
const openStatsModal = async (tokenId) => {
  showModalSkeleton();
  const stats = await fetchTokenStats(tokenId);
  renderStatsModal(stats);
}
```

### 📊 Real-time обновления:

#### WebSocket подключение для live updates:
```javascript
const wsUpdates = {
  tokenUsageUpdate: (data) => updateProgressBars(data),
  tokenStatusChange: (data) => updateStatusIndicators(data),
  systemAlert: (data) => showNotificationBanner(data)
}
```

#### Smart polling (адаптивная частота обновлений):
```javascript
const pollingStrategy = {
  active: 10000,    // 10 сек при активном использовании
  idle: 30000,      // 30 сек при простое
  background: 60000 // 1 мин когда вкладка неактивна
}
```

---

*UX сценарии разработаны для максимального удобства администраторов ChatAI при управлении пулом AI токенов. Учитывают реальные паттерны использования и критические ситуации.*

**Версия**: 1.0  
**Дата**: 25.01.2025  
**Автор**: Frontend UX Designer ChatAI Team