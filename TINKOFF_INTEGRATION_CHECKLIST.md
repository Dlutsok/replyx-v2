# –ü–æ–ª–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¢–∏–Ω—å–∫–æ—Ñ –ë–∞–Ω–∫–æ–º (—ç–∫–≤–∞–π—Ä–∏–Ω–≥)
*–í–µ—Ä—Å–∏—è API: 2.0 | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2025-09-09*

## üîç –ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ô –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- **Backend**: –ú–æ–¥–µ–ª—å Payment, API endpoints, –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏
- **Frontend**: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–∞–ª–∞–Ω—Å–∞, –≤–∏–¥–∂–µ—Ç—ã –æ–ø–ª–∞—Ç—ã, integration.js
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –¢–∞–±–ª–∏—Ü–∞ payments —Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, CSP –ø–æ–ª–∏—Ç–∏–∫–∏
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Mock —Ä–µ–∂–∏–º, —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
- **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç endpoint –¥–ª—è webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- **–ù–µ–ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π**
- **–ù–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä OperationInitiatorType**
- **–ù–µ–ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫**

---

## 1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ –ú–ï–¢–û–î–ê Init

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```python
data = {
    'TerminalKey': TINKOFF_TERMINAL_KEY,  # ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
    'OrderId': order_id,                  # ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π 
    'Amount': amount,                     # ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π (–≤ –∫–æ–ø–µ–π–∫–∞—Ö)
    'Token': token,                       # ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π (–ø–æ–¥–ø–∏—Å—å)
}
```

### ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

#### **OperationInitiatorType** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!)
**–°—Ç–∞—Ç—É—Å**: ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢  
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ API
**–ó–Ω–∞—á–µ–Ω–∏—è**: 
- `'Customer'` - –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `'Merchant'` - –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä –º–µ—Ä—á–∞–Ω—Ç

**–†–µ—à–µ–Ω–∏–µ**:
```python
data['OperationInitiatorType'] = 'Customer'
```

### ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```python
'Currency': 'RUB',           # ‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
'Description': description,   # ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
'CustomerKey': customer_key,  # ‚úÖ –î–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫–∞—Ä—Ç
'SuccessURL': success_url,    # ‚úÖ URL —É—Å–ø–µ—Ö–∞
'FailURL': fail_url,         # ‚úÖ URL –æ—à–∏–±–∫–∏
'Language': 'ru',            # ‚úÖ –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
'PayType': 'O'               # ‚úÖ –û–¥–Ω–æ—Å—Ç–∞–¥–∏–π–Ω—ã–π –ø–ª–∞—Ç–µ–∂
```

### üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ data:
'Email': customer_email,           # –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ–∫–∞
'Phone': customer_phone,           # –î–ª—è –°–ú–° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π  
'Name': customer_name,             # –§–ò–û –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞
'Receipt': receipt_data,           # –î–∞–Ω–Ω—ã–µ —á–µ–∫–∞ (54-–§–ó)
'PaymentSource': 'web',           # –ò—Å—Ç–æ—á–Ω–∏–∫ –ø–ª–∞—Ç–µ–∂–∞
'IP': client_ip,                  # IP –∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞
'RedirectDueDate': expiry_date,   # –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–∫–∏
```

---

## 2. –ê–õ–ì–û–†–ò–¢–ú –§–û–†–ú–ò–†–û–í–ê–ù–ò–Ø –¢–û–ö–ï–ù–ê (–ü–û–î–ü–ò–°–ò)

### ‚úÖ –¢–µ–∫—É—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º (–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π):
```python
def calculate_signature(data: dict) -> str:
    # 1. –ò—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    filtered_data = {k: v for k, v in data.items() 
                    if k not in ['token', 'Token'] and v is not None and str(v).strip() != ''}
    
    # 2. –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
    filtered_data['Password'] = TINKOFF_SECRET_KEY
    
    # 3. –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–ª—é—á–∞–º
    sorted_keys = sorted(filtered_data.keys())
    
    # 4. –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏
    concatenated_values = [str(filtered_data[key]) for key in sorted_keys]
    concatenated_string = ''.join(concatenated_values)
    
    # 5. SHA256 —Ö–µ—à
    return hashlib.sha256(concatenated_string.encode('utf-8')).hexdigest()
```

### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
- ‚úÖ **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–µ–π**: token, Token, –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è**: –∫–∞–∫ –ø–æ–ª–µ 'Password'
- ‚úÖ **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: –ø–æ –∫–ª—é—á–∞–º –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ  
- ‚úÖ **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: UTF-8
- ‚úÖ **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: SHA256
- ‚úÖ **–§–æ—Ä–º–∞—Ç**: lowercase hex

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–∞—Ä–æ–ª—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ debug —Ä–µ–∂–∏–º–µ (—É–≥—Ä–æ–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
2. **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–¥ str()

**–£–ª—É—á—à–µ–Ω–∏—è**:
```python
def calculate_signature(data: dict) -> str:
    filtered_data = {}
    for k, v in data.items():
        if k.lower() in ['token'] or v is None:
            continue
        # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
        if isinstance(v, bool):
            filtered_data[k] = 'true' if v else 'false'
        elif isinstance(v, (int, float)):
            filtered_data[k] = str(v)
        else:
            filtered_data[k] = str(v).strip()
            
    filtered_data['Password'] = TINKOFF_SECRET_KEY
    
    sorted_keys = sorted(filtered_data.keys())
    concatenated_string = ''.join([filtered_data[key] for key in sorted_keys])
    
    # –ù–ï –ª–æ–≥–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å!
    logger.debug(f"Signature keys: {[k for k in sorted_keys if k != 'Password']}")
    
    return hashlib.sha256(concatenated_string.encode('utf-8')).hexdigest()
```

---

## 3. –°–¢–ê–¢–£–°–ù–ê–Ø –ú–û–î–ï–õ–¨ –ü–õ–ê–¢–ï–ñ–ï–ô

### ‚úÖ –¢–µ–∫—É—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã –≤ –ë–î:
```python
status = Column(String, default='pending')
# 'pending', 'processing', 'success', 'failed', 'cancelled'
```

### üìã –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç—É—Å–Ω–∞—è –º–æ–¥–µ–ª—å –¢–∏–Ω—å–∫–æ—Ñ:

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã**:
- **`NEW`** - –ø–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω
- **`FORM_SHOWED`** - –ø–æ–∫—É–ø–∞—Ç–µ–ª—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ —Ñ–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã  
- **`AUTHORIZING`** - –∏–¥–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **`3DS_CHECKING`** - –ø—Ä–æ–≤–µ—Ä–∫–∞ 3DS
- **`AUTH_FAIL`** - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
- **`AUTHORIZED`** - –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- **`CONFIRMING`** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è
- **`CONFIRMED`** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
- **`REVERSING`** - –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è  
- **`PARTIAL_REVERSED`** - —á–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω
- **`REVERSED`** - –æ—Ç–º–µ–Ω–µ–Ω
- **`REFUNDING`** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
- **`PARTIAL_REFUNDED`** - —á–∞—Å—Ç–∏—á–Ω–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω  
- **`REFUNDED`** - –≤–æ–∑–≤—Ä–∞—â–µ–Ω
- **`DEADLINE_EXPIRED`** - –∏—Å—Ç–µ–∫ —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã
- **`REJECTED`** - –æ—Ç–∫–ª–æ–Ω–µ–Ω
- **`CANCELED`** - –æ—Ç–º–µ–Ω–µ–Ω

#### **–ú–∞–ø–ø–∏–Ω–≥ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏**:
```python
TINKOFF_STATUS_MAPPING = {
    'NEW': 'pending',
    'FORM_SHOWED': 'pending', 
    'AUTHORIZING': 'processing',
    '3DS_CHECKING': 'processing',
    'AUTHORIZED': 'processing',
    'CONFIRMING': 'processing', 
    'CONFIRMED': 'success',
    'AUTH_FAIL': 'failed',
    'REJECTED': 'failed',
    'DEADLINE_EXPIRED': 'failed',
    'CANCELED': 'cancelled',
    'REVERSED': 'cancelled',
    'PARTIAL_REVERSED': 'partial_refunded',  # –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
    'REFUNDED': 'refunded',                  # –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
    'PARTIAL_REFUNDED': 'partial_refunded',  # –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
}
```

---

## 4. –û–ë–†–ê–ë–û–¢–ö–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô (NOTIFICATIONS)

### ‚ùå **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç endpoint –¥–ª—è webhook

**–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å**:
```python
@router.post("/tinkoff-notification")
async def handle_tinkoff_notification(request: Request, db: Session = Depends(get_db)):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –¢–∏–Ω—å–∫–æ—Ñ—Ñ –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–∞"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        form_data = await request.form()
        data = dict(form_data)
        
        logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç –¢–∏–Ω—å–∫–æ—Ñ—Ñ: {data}")
        
        # –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å
        received_token = data.pop('Token', '')
        calculated_token = calculate_signature(data)
        
        if received_token.lower() != calculated_token.lower():
            logger.error(f"–ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {received_token} != {calculated_token}")
            raise HTTPException(status_code=400, detail="Invalid signature")
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ  
        order_id = data.get('OrderId')
        status = data.get('Status') 
        payment_id = data.get('PaymentId')
        
        payment = db.query(Payment).filter(Payment.order_id == order_id).first()
        if not payment:
            logger.warning(f"–ü–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω: {order_id}")
            return {"status": "ok"}  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º OK —á—Ç–æ–±—ã –¢–∏–Ω—å–∫–æ—Ñ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª
            
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        old_status = payment.status
        payment.status = TINKOFF_STATUS_MAPPING.get(status, 'unknown')
        payment.tinkoff_payment_id = payment_id
        
        if payment.status == 'success' and old_status != 'success':
            payment.completed_at = datetime.utcnow()
            
            # –ü–æ–ø–æ–ª–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            from services.balance_service import BalanceService
            balance_service = BalanceService(db)
            balance_service.add_balance(
                user_id=payment.user_id,
                amount=payment.amount,
                transaction_type='payment_topup',
                description=f"–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫ (–∑–∞–∫–∞–∑ {order_id})"
            )
            
        db.commit()
        
        return {"status": "ok"}
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}")
        raise HTTPException(status_code=500, detail="Internal server error")
```

### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NotificationURL:
```python
# –í .env –¥–æ–±–∞–≤–∏—Ç—å:
TINKOFF_NOTIFICATION_URL=https://yourdomain.com/api/payments/tinkoff-notification

# –í –∫–æ–¥–µ:
if os.getenv('TINKOFF_NOTIFICATION_URL'):
    data['NotificationURL'] = os.getenv('TINKOFF_NOTIFICATION_URL')
```

---

## 5. –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã:
- ‚úÖ **–ü–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤**: SHA256 —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
- ‚úÖ **HTTPS**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞  
- ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –≤ –∫–æ–¥–µ
- ‚úÖ **CSP –ø–æ–ª–∏—Ç–∏–∫–∏**: –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –¢-–ë–∞–Ω–∫ –¥–æ–º–µ–Ω–æ–≤

### ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:

#### 1. **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –≤—Ö–æ–¥—è—â–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –≤ webhook endpoint (—Å–º. –≤—ã—à–µ)

#### 2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤**  
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–∞—Ä–æ–ª—å –∏ —Ç–æ–∫–µ–Ω—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
```python
# –û–ü–ê–°–ù–û:
logger.error(f"–†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω: {token}")
```

**–†–µ—à–µ–Ω–∏–µ**:
```python
# –ë–ï–ó–û–ü–ê–°–ù–û:
logger.info(f"–¢–æ–∫–µ–Ω —Ä–∞—Å—Å—á–∏—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ –¥–ª—è OrderId: {order_id}")
```

#### 3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç whitelist IP –¢–∏–Ω—å–∫–æ—Ñ—Ñ –¥–ª—è webhook  
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É IP –≤ nginx –∏–ª–∏ –∫–æ–¥–µ:
```python
TINKOFF_IPS = ['91.194.226.0/23', '185.71.76.0/27', '185.71.77.0/27']

def is_tinkoff_ip(client_ip: str) -> bool:
    import ipaddress
    client = ipaddress.ip_address(client_ip)
    for network in TINKOFF_IPS:
        if client in ipaddress.ip_network(network):
            return True
    return False
```

#### 4. **–¢–∞–π–º-–∞—É—Ç—ã –∏ –ø–æ–≤—Ç–æ—Ä—ã**  
**–†–µ—à–µ–Ω–∏–µ**:
```python
async def init_payment_tinkoff(...):
    max_retries = 3
    for attempt in range(max_retries):
        try:
            response = await httpx.AsyncClient().post(
                f"{TINKOFF_API_URL}Init",
                json=data,
                timeout=30.0,  # –°—Ç—Ä–æ–≥–∏–π —Ç–∞–π–º-–∞—É—Ç
                headers={'User-Agent': 'YourApp/1.0'}
            )
            break
        except httpx.TimeoutException:
            if attempt == max_retries - 1:
                raise
            await asyncio.sleep(2 ** attempt)  # Exponential backoff
```

---

## 6. –ö–û–î–´ –û–®–ò–ë–û–ö –ò –û–ë–†–ê–ë–û–¢–ö–ê

### üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ –¢–∏–Ω—å–∫–æ—Ñ:

#### **–û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**:
- **0** - –£—Å–ø–µ—à–Ω–æ
- **101** - –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª
- **102** - –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
- **103** - –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏  
- **104** - –ù–µ–≤–µ—Ä–Ω–∞—è –≤–∞–ª—é—Ç–∞
- **105** - –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞

#### **–û—à–∏–±–∫–∏ –ø–ª–∞—Ç–µ–∂–∞**:
- **106** - –ü–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω
- **107** - –ü–ª–∞—Ç–µ–∂ –≤ –Ω–µ–≤–µ—Ä–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ
- **108** - –ü—Ä–µ–≤—ã—à–µ–Ω —Å—Ä–æ–∫ –ø–ª–∞—Ç–µ–∂–∞
- **109** - –û—à–∏–±–∫–∞ –±–∞–Ω–∫–∞-—ç–º–∏—Ç–µ–Ω—Ç–∞
- **110** - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤

#### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏**:  
- **111** - –°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞
- **112** - –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
- **113** - –î—É–±–ª—å –æ–ø–µ—Ä–∞—Ü–∏–∏
- **114** - –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
```python
TINKOFF_ERROR_MESSAGES = {
    101: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TerminalKey",
    102: "–ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–ª–≥–æ—Ä–∏—Ç–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞", 
    103: "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É",
    104: "–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –≤–∞–ª—é—Ç–∞",
    105: "–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞",
    106: "–ü–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω", 
    107: "–ü–ª–∞—Ç–µ–∂ –Ω–µ–ª—å–∑—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ç–µ–∫—É—â–µ–º —Å—Ç–∞—Ç—É—Å–µ",
    108: "–ò—Å—Ç–µ–∫ —Å—Ä–æ–∫ –ø–ª–∞—Ç–µ–∂–∞",
    109: "–û—Ç–∫–∞–∑ –±–∞–Ω–∫–∞-—ç–º–∏—Ç–µ–Ω—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É",
    110: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –∫–∞—Ä—Ç–µ",
    111: "–°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∑–∂–µ",
    112: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö",
    113: "–î—É–±–ª—å –æ–ø–µ—Ä–∞—Ü–∏–∏",
    114: "–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞"
}

async def init_payment_tinkoff(...):
    try:
        response = requests.post(f"{TINKOFF_API_URL}Init", json=data, timeout=30)
        
        if response.status_code == 200:
            result = response.json()
            if result.get('Success'):
                return result['PaymentURL']
            else:
                error_code = result.get('ErrorCode', 0)
                error_msg = TINKOFF_ERROR_MESSAGES.get(error_code, result.get('Message', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'))
                
                logger.error(f"–û—à–∏–±–∫–∞ –¢–∏–Ω—å–∫–æ—Ñ—Ñ: –∫–æ–¥ {error_code}, —Å–æ–æ–±—â–µ–Ω–∏–µ: {error_msg}")
                raise PaymentException(f"–û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã: {error_msg}", error_code)
                
    except requests.exceptions.Timeout:
        raise PaymentException("–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã", 999)
    except requests.exceptions.ConnectionError:
        raise PaymentException("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π", 998)

class PaymentException(Exception):
    def __init__(self, message: str, error_code: int = 0):
        self.message = message
        self.error_code = error_code
        super().__init__(self.message)
```

---

## 7. –ù–ê–°–¢–†–û–ô–ö–ò –¢–ï–†–ú–ò–ù–ê–õ–ê 

### üìã –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –õ–ö –¢–∏–Ω—å–∫–æ—Ñ:

#### **–û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**:
- ‚úÖ **–ü—Ä–æ—Ç–æ–∫–æ–ª**: HTTP/HTTPS (—Ç–æ–ª—å–∫–æ HTTPS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
- ‚úÖ **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: UTF-8  
- ‚úÖ **–§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**: JSON –∏–ª–∏ Form data
- ‚ö†Ô∏è **IP –∞–¥—Ä–µ—Å–∞**: –î–æ–±–∞–≤–∏—Ç—å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –≤ whitelist

#### **URL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**:  
- ‚úÖ **Success URL**: `https://yourdomain.com/payment/success`
- ‚úÖ **Fail URL**: `https://yourdomain.com/payment/error` 
- ‚ùå **Notification URL**: `https://yourdomain.com/api/payments/tinkoff-notification` (–î–û–ë–ê–í–ò–¢–¨!)

#### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- **3DS**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–∫–ª—é—á–∏—Ç—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç**: –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤  
- **–ü–ª–∞—Ç–µ–∂–∏ –±–µ–∑ CVV**: –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç
- **–°–ë–ü**: –°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- **–†–∞—Å—Å—Ä–æ—á–∫–∞**: –¢–∏–Ω—å–∫–æ—Ñ—Ñ –†–∞—Å—Å—Ä–æ—á–∫–∞

---

## 8. –ü–ê–†–ê–ú–ï–¢–† OperationInitiatorType

### ‚ùå **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!

**–û–ø–∏—Å–∞–Ω–∏–µ**: –° –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ API —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä —Å—Ç–∞–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –¶–ë –†–§.

**–ó–Ω–∞—á–µ–Ω–∏—è**:
- **`Customer`** - –æ–ø–µ—Ä–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–ª–∞—Ç–µ–∂–µ–π)
- **`Merchant`** - –æ–ø–µ—Ä–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞ –º–µ—Ä—á–∞–Ω—Ç–æ–º

**–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–¥**:
```python
data = {
    'TerminalKey': TINKOFF_TERMINAL_KEY,
    'OrderId': order_id,  
    'Amount': amount,
    'OperationInitiatorType': 'Customer',  # ‚Üê –î–û–ë–ê–í–ò–¢–¨ –≠–¢–û!
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
}
```

---

## 9. INTEGRATION.JS –ò –°–û–í–†–ï–ú–ï–ù–ù–´–ï –í–ò–î–ñ–ï–¢–´

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `https://integrationjs.tbank.ru/integration.js`
- ‚úÖ CSP –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤ –¢-–ë–∞–Ω–∫
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ T-Pay, –°–ë–ü, BNPL –≤–∏–¥–∂–µ—Ç–æ–≤
- ‚úÖ Fallback –∫ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É –º–µ—Ç–æ–¥—É

### üîß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:
```javascript  
// –í _app.tsx –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
<Script src="https://integrationjs.tbank.ru/integration.js" />

// –í balance.js –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
if (window.PaymentIntegration) {
    window.PaymentIntegration.init({
        terminalKey: process.env.NEXT_PUBLIC_TINKOFF_TERMINAL_KEY
    });
}
```

---

## 10. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
```
TerminalKey: 1757348842151DEMO  
SecretKey: lczutIQhGoZoZrgW
```

### üìã –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:
- **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂**: `2200000000000004`
- **–û—Ç–∫–ª–æ–Ω–µ–Ω –±–∞–Ω–∫–æ–º**: `2200000000000012` 
- **3DS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: `2200000000000020`
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤**: `2200000000000038`

### üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞** - Init –º–µ—Ç–æ–¥
2. **–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞** - –¥–æ —Å—Ç–∞—Ç—É—Å–∞ CONFIRMED
3. **–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞** - —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏  
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞
5. **–í–æ–∑–≤—Ä–∞—Ç—ã** - Refund –º–µ—Ç–æ–¥
6. **3DS** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è  
7. **–í–∏–¥–∂–µ—Ç—ã** - –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
8. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π

---

## 11. –ò–¢–û–ì–û–í–´–ô –ß–ï–ö-–õ–ò–°–¢ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### üî¥ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–°–ü–†–ê–í–ò–¢–¨**:

- [ ] **–î–æ–±–∞–≤–∏—Ç—å OperationInitiatorType** –≤ Init –∑–∞–ø—Ä–æ—Å
- [ ] **–°–æ–∑–¥–∞—Ç—å endpoint** –¥–ª—è webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π  
- [ ] **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏** —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] **–£–±—Ä–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å NotificationURL** –≤ –õ–ö –¢–∏–Ω—å–∫–æ—Ñ—Ñ
- [ ] **–î–æ–±–∞–≤–∏—Ç—å IP whitelist** –¥–ª—è webhook
- [ ] **–†–∞—Å—à–∏—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å–Ω—É—é –º–æ–¥–µ–ª—å** –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –¢–∏–Ω—å–∫–æ—Ñ—Ñ
- [ ] **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏

### üü° **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø**:

- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Email, Phone, Name –¥–ª—è —á–µ–∫–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ GetState –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å Refund –º–µ—Ç–æ–¥ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤  
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å Rate Limiting –¥–ª—è API
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤

### üü¢ **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û**:

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –°–ë–ü —á–µ—Ä–µ–∑ –≤–∏–¥–∂–µ—Ç—ã
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å—Å—Ä–æ—á–∫–∏
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –ü–û–î–î–ï–†–ñ–ö–ò

- **–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞**: acquiring@tbank.ru
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://www.tbank.ru/kassa/develop/  
- **–°—Ç–∞—Ç—É—Å API**: https://status.tbank.ru/
- **–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞**: https://rest-api-test.tinkoff.ru/v2/
- **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∞—è —Å—Ä–µ–¥–∞**: https://securepay.tinkoff.ru/v2/

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢–∏–Ω—å–∫–æ—Ñ API v2.0*