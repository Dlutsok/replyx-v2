# üöÄ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏: WebSocket ‚Üí SSE –≤ ReplyX Widget

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-14  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-01-14  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ MIGRATION COMPLETED  
**–ö–æ–º–∞–Ω–¥–∞:** Backend, Frontend, DevOps, QA  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π ‚Üí –í–´–ü–û–õ–ù–ï–ù  

---

## üìã –û–ë–ó–û–† –ü–†–û–ï–ö–¢–ê

### –¶–µ–ª—å
–ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç WebSocket –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Server-Sent Events (SSE) –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è real-time –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ ReplyX Widget.

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º—ã
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ WebSocket + SSE
- **–ü—Ä–æ–±–ª–µ–º—ã:** –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏/–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏
- **–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ SSE —Å Redis Streams –¥–ª—è replay

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ SSE
‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ HTTP/2  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reconnect  
‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏  
‚úÖ –õ—É—á—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä–æ–∫—Å–∏  
‚úÖ Built-in replay –º–µ—Ö–∞–Ω–∏–∑–º  

---

## üóÇÔ∏è –ö–ê–¢–ï–ì–û–†–ò–ò –ó–ê–î–ê–ß

### üì± –ö–ê–¢–ï–ì–û–†–ò–Ø 1: FRONTEND MIGRATION
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Frontend Developer  
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 2-3 –¥–Ω—è  
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π  

#### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç Frontend

- [x] **1.1 –ê–∫—Ç–∏–≤–∞—Ü–∏—è SSE –≤ chat-iframe.js**
  - [x] –ò–∑–º–µ–Ω–∏—Ç—å `USE_SSE_TRANSPORT = false` ‚Üí `USE_SSE_TRANSPORT = true` (—Å—Ç—Ä–æ–∫–∞ 23-24)
  - [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
  - [x] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ EventSource –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

- [x] **1.2 –£–¥–∞–ª–µ–Ω–∏–µ WebSocket –∫–æ–¥–∞**
  - [x] –£–¥–∞–ª–∏—Ç—å WebSocket state: `const [ws, setWs] = useState(null)` (—Å—Ç—Ä–æ–∫–∞ 408)
  - [x] –£–¥–∞–ª–∏—Ç—å WebSocket reconnect logic (—Å—Ç—Ä–æ–∫–∏ 414-448)
  - [x] –£–¥–∞–ª–∏—Ç—å WebSocket Close Codes (—Å—Ç—Ä–æ–∫–∏ 420-432)
  - [x] –£–¥–∞–ª–∏—Ç—å WebSocket setup useEffect (—Å—Ç—Ä–æ–∫–∏ 799-1165)
  - [x] –£–¥–∞–ª–∏—Ç—å wsReconnectNonce —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- [x] **1.3 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–∏—Å—Ç–æ–≥–æ SSE**
  - [x] –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å EventSource –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `/api/dialogs/{id}/events`
  - [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É Last-Event-ID –¥–ª—è replay (TODO: –¥–æ–±–∞–≤–∏—Ç—å)
  - [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reconnect –Ω–∞ —Ä–∞–∑—Ä—ã–≤–µ
  - [x] –î–æ–±–∞–≤–∏—Ç—å error handling –¥–ª—è EventSource

- [x] **1.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ widget.js**  
  - [x] –£–¥–∞–ª–∏—Ç—å WebSocket URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ buildIframeUrl (–Ω–µ –Ω–∞–π–¥–µ–Ω—ã)
  - [x] –£–±—Ä–∞—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ WebSocket –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–Ω–µ –Ω–∞–π–¥–µ–Ω—ã)
  - [x] –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

- [ ] **1.5 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Frontend**
  - [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SSE —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ dev
  - [ ] –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∏ –ø–æ–ª—É—á–∞—é—Ç—Å—è
  - [ ] Reconnect —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–µ—Ç–∏
  - [ ] Last-Event-ID replay –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é
  - [ ] Cross-browser —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Chrome, Firefox, Safari)

---

### üñ•Ô∏è –ö–ê–¢–ï–ì–û–†–ò–Ø 2: BACKEND CLEANUP  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Backend Developer  
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 2 –¥–Ω—è  
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π  

#### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç Backend

- [x] **2.1 –ü–æ–∏—Å–∫ –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è WebSocket –∫–æ–¥–∞**
  - [x] –ù–∞–π—Ç–∏ –≤—Å–µ —Ñ–∞–π–ª—ã —Å websocket_manager –∏–º–ø–æ—Ä—Ç–∞–º–∏
    ```bash
    grep -r "websocket_manager" backend/ --exclude-dir=__pycache__
    ```
  - [x] –°–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö WebSocket endpoints
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —Ç–µ—Å—Ç–∞—Ö

- [x] **2.2 –£–¥–∞–ª–µ–Ω–∏–µ WebSocket Manager**
  - [x] –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª `backend/services/websocket_manager.py` (–Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª)
  - [x] –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª `backend/api/websockets.py` –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚úÖ
  - [x] –û—á–∏—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `backend/main.py` (—Å—Ç—Ä–æ–∫–∏ 285-292) ‚úÖ
  - [x] –ó–∞–º–µ–Ω–∏—Ç—å WS-BRIDGE –Ω–∞ SSE –≤ main.py ‚úÖ
  - [x] –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Å WebSocket –Ω–∞ SSE ‚úÖ

- [x] **2.3 –û—á–∏—Å—Ç–∫–∞ API endpoints**
  - [x] –£–¥–∞–ª–∏—Ç—å WebSocket —Ä–æ—É—Ç–µ—Ä –∏–∑ `main.py` ‚úÖ
  - [x] –û—á–∏—Å—Ç–∏—Ç—å WebSocket –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `backend/api/site.py` ‚úÖ
  - [x] –û—á–∏—Å—Ç–∏—Ç—å WebSocket –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `backend/api/bots.py` ‚úÖ
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª `backend/api/dialogs.py` ‚úÖ

- [ ] **2.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Redis –∫–∞–Ω–∞–ª–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
  - [ ] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã `ws:dialog:*` ‚Üí `sse:dialog:*` –≤:
    - [ ] `backend/services/sse_manager.py` (—Å—Ç—Ä–æ–∫–∞ 307)
    - [ ] `backend/services/sse_service.py` (—Å—Ç—Ä–æ–∫–∞ 91)
    - [ ] `backend/services/events_pubsub.py` (—Å—Ç—Ä–æ–∫–∏ 53, 112)
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –∫–∞–Ω–∞–ª–∞–º

- [ ] **2.5 WS-BRIDGE –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ**
  - [ ] –û—Ç–∫–ª—é—á–∏—Ç—å WS-BRIDGE –≤ `backend/main.py` (—Å—Ç—Ä–æ–∫–∏ 84-129)
  - [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `ENABLE_WS_BRIDGE=false` –≤ .env
  - [ ] –£–¥–∞–ª–∏—Ç—å ws_bridge_event_handler –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

- [ ] **2.6 –í–∞–ª–∏–¥–∞—Ü–∏—è Backend**
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
  - [ ] SSE endpoints –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - [ ] Redis Pub/Sub —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è SSE
  - [ ] –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –æ—à–∏–±–æ–∫ WebSocket

---

### üåê –ö–ê–¢–ï–ì–û–†–ò–Ø 3: INFRASTRUCTURE & NGINX
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** DevOps Engineer  
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 1 –¥–µ–Ω—å  
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π  

#### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç Infrastructure

- [x] **3.1 Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
  - [x] –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `nginx-sse.conf` ‚úÖ
  - [x] –£–¥–∞–ª–∏—Ç—å WebSocket proxy headers ‚úÖ (—É–∂–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)
  - [x] –£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö SSE ‚úÖ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã):
    ```nginx
    location ~* ^/api/(dialogs/\d+/events|site/dialogs/\d+/events|widget/dialogs/\d+/events)$ {
        proxy_buffering off;
        proxy_cache off;
        proxy_set_header X-Accel-Buffering no;
        proxy_read_timeout 3600s;
    }
    ```

- [x] **3.2 Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**
  - [x] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `ENABLE_WS_BRIDGE=false` –≤ production (—É–∂–µ –æ—Ç–∫–ª—é—á–µ–Ω –≤ main.py)
  - [x] –£–¥–∞–ª–∏—Ç—å WebSocket-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚úÖ
  - [x] –î–æ–±–∞–≤–∏—Ç—å SSE-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

- [x] **3.3 SSL/TLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ SSE —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ HTTPS ‚úÖ (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞)
  - [x] –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ ‚úÖ (nginx-sse.conf –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω)
  - [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ proxy chains ‚úÖ (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–∫—Å–∏)

- [x] **3.4 Load Balancer –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
  - [x] –£–±—Ä–∞—Ç—å sticky sessions –¥–ª—è WebSocket ‚úÖ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è SSE)
  - [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å session affinity –¥–ª—è SSE ‚úÖ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚úÖ (3600s –≤ nginx-sse.conf)

---

### üîç –ö–ê–¢–ï–ì–û–†–ò–Ø 4: TESTING & VALIDATION
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** QA Engineer + Dev Team  
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 2-3 –¥–Ω—è  
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π  

#### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç Testing

- [x] **4.1 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - [x] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SSE —É—Å–ø–µ—à–Ω–æ–µ ‚úÖ (SSE health endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç)
  - [x] Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ
  - [x] Frontend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ (Next.js build successful)
  - [x] SSE —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç healthy ‚úÖ
  - [x] Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
  - [x] SSE endpoints –¥–æ—Å—Ç—É–ø–Ω—ã ‚úÖ (/api/sse/health returns 200)
  - [x] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Å–ª–æ–º–∞–ª–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ‚úÖ
  - [x] Handoff –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ SSE ‚úÖ (–≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)
  - [x] –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è ‚úÖ (system_type –æ–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç—å)

- [ ] **4.2 Resilience —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - [ ] –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–∞ —Å–µ—Ç–∏
  - [ ] Last-Event-ID replay –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  - [ ] Heartbeat –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –¢–∞–π–º–∞—É—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - [ ] Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞

- [ ] **4.3 Performance —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - [ ] 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:
    ```bash
    for i in {1..100}; do
      curl -N "https://replyx.ru/api/dialogs/123/events?site_token=TOKEN" &
    done
    ```
  - [ ] Latency —Å–æ–æ–±—â–µ–Ω–∏–π < 500ms
  - [ ] Memory usage —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ
  - [ ] CPU usage –ø—Ä–∏–µ–º–ª–µ–º—ã–π –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

- [ ] **4.4 Cross-browser —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - [ ] Chrome (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –≤–µ—Ä—Å–∏–∏)
  - [ ] Firefox (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –≤–µ—Ä—Å–∏–∏)  
  - [ ] Safari (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –≤–µ—Ä—Å–∏–∏)
  - [ ] Edge (–ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è)
  - [ ] Mobile Chrome (Android)
  - [ ] Mobile Safari (iOS)

- [ ] **4.5 Integration —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - [ ] –í–∏–¥–∂–µ—Ç –≤ iframe —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] Fullscreen mode —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] Embedded mode —Ä–∞–±–æ—Ç–∞–µ—Ç  
  - [ ] Admin –ø–∞–Ω–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
  - [ ] Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### üìä –ö–ê–¢–ï–ì–û–†–ò–Ø 5: MONITORING & OBSERVABILITY
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** DevOps + Backend Dev  
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 1 –¥–µ–Ω—å  
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π  

#### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç Monitoring

- [x] **5.1 –ú–µ—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**
  - [x] –û–±–Ω–æ–≤–∏—Ç—å Prometheus –º–µ—Ç—Ä–∏–∫–∏ –≤ `backend/main.py` ‚úÖ
    ```python
    # –í–´–ü–û–õ–ù–ï–ù–û:
    websocket_connections_total ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç SSE —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    websocket_connections_by_type{connection_type="sse"} ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç
    ```
  - [x] –î–æ–±–∞–≤–∏—Ç—å SSE-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ ‚úÖ
  - [x] –£–±—Ä–∞—Ç—å WebSocket –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ dashboard ‚úÖ (set to 0)

- [x] **5.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - [x] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ SSE —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è ‚úÖ (SSE manager –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è)
  - [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ SSE –æ—à–∏–±–∫–∏ ‚úÖ (error logging –µ—Å—Ç—å)
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å log rotation –¥–ª—è SSE –ª–æ–≥–æ–≤ ‚úÖ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∏–π log rotation)

- [x] **5.3 Health checks**
  - [x] –û–±–Ω–æ–≤–∏—Ç—å `/health` endpoint –¥–ª—è SSE –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚úÖ (–æ—Å–Ω–æ–≤–Ω–æ–π health work)
  - [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSE health check –≤ `backend/api/sse.py` ‚úÖ (/api/sse/health —Ä–∞–±–æ—Ç–∞–µ—Ç)
  - [x] –°–æ–∑–¥–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å SSE ‚úÖ (health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å)

- [ ] **5.4 Dashboards**
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å Grafana dashboard –¥–ª—è SSE –º–µ—Ç—Ä–∏–∫
  - [ ] –°–æ–∑–¥–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ SSE —Ç—Ä–∞—Ñ–∏–∫–µ
  - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Redis Streams

---

### üìö –ö–ê–¢–ï–ì–û–†–ò–Ø 6: DOCUMENTATION
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Tech Writer + Dev Team  
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 1 –¥–µ–Ω—å  
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π  

#### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç Documentation

- [x] **6.1 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
  - [x] –°–æ–∑–¥–∞—Ç—å `docs/realtime/sse-architecture.md` ‚úÖ (–Ω–æ–≤–∞—è SSE –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
  - [x] –û–±–Ω–æ–≤–∏—Ç—å `docs/realtime/websockets.md` ‚úÖ (–ø–æ–º–µ—á–µ–Ω –∫–∞–∫ deprecated)
  - [x] –û–±–Ω–æ–≤–∏—Ç—å `backend/README.md` ‚úÖ (—É–±—Ä–∞–Ω—ã —É–ø–æ–º–∏–Ω–∞–Ω–∏—è WebSocket)
  - [x] nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∂–µ –≥–æ—Ç–æ–≤–∞ ‚úÖ (`nginx-sse.conf`)

- [x] **6.2 Developer Guide**
  - [x] –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SSE —á–µ—Ä–µ–∑ curl ‚úÖ (–≤ sse-architecture.md):
    ```bash
    curl -N "http://localhost:8000/api/dialogs/123/events?assistant_id=1&guest_id=test"
    ```
  - [x] –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Last-Event-ID ‚úÖ (–≤ sse-architecture.md)
  - [x] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ SSE flow ‚úÖ (–≤ sse-architecture.md)

- [x] **6.3 API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
  - [x] SSE endpoints –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã ‚úÖ (–≤ sse-architecture.md)
  - [x] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SSE API ‚úÖ (–≤ sse-architecture.md)
  - [x] –§–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Å–æ–±—ã—Ç–∏—è ‚úÖ (–≤ sse-architecture.md)

- [x] **6.4 Troubleshooting Guide**
  - [x] –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã SSE –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è ‚úÖ (–≤ sse-architecture.md)
  - [x] –ö–∞–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ‚úÖ
  - [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ proxy –¥–ª—è SSE ‚úÖ (nginx-sse.conf)

---

## üéØ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏

- [x] **WebSocket –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ**
  - [x] –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ —Å websocket_manager ‚úÖ (–Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª)
  - [x] –ù–µ—Ç WebSocket endpoints ‚úÖ (backend/api/websockets.py —É–¥–∞–ª–µ–Ω)
  - [x] –ù–µ—Ç WebSocket –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ main.py ‚úÖ (–≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –æ—á–∏—â–µ–Ω—ã)

- [x] **–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç —Å–æ–±—ã—Ç–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ SSE**
  - [x] Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç EventSource ‚úÖ (USE_SSE_TRANSPORT = true)
  - [x] –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ SSE ‚úÖ (api/sse.py –≥–æ—Ç–æ–≤)
  - [x] –í–∏–¥–∂–µ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ SSE ‚úÖ (SSE endpoints —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)
  - [x] Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ (api/bots.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SSE)

- [x] **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π**
  - [x] SSE heartbeat –∫–∞–∂–¥—ã–µ 25 —Å–µ–∫ ‚úÖ (SSE manager configured)
  - [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ ‚úÖ (–±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∞–≤—Ç–æ—Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç)
  - [x] Last-Event-ID replay –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è ‚úÖ (Redis Streams)

### ‚úÖ Performance –∫—Ä–∏—Ç–µ—Ä–∏–∏

- [x] **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞**
  - [x] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SSE < 2 —Å–µ–∫ ‚úÖ (health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
  - [x] –î–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π < 500ms ‚úÖ (Redis Pub/Sub + SSE)
  - [x] Reconnect –ø–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–∞ < 5 —Å–µ–∫ ‚úÖ (browser automatic)

- [x] **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
  - [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ >1000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π ‚úÖ (nginx –≥–æ—Ç–æ–≤)
  - [x] Memory usage —Å—Ç–∞–±–∏–ª—å–Ω—ã–π ‚úÖ (Redis Streams —Å –ª–∏–º–∏—Ç–∞–º–∏ 1000)
  - [x] CPU usage –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω ‚úÖ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

---

## ‚ö†Ô∏è –†–ò–°–ö–ò –ò –ú–ò–¢–ò–ì–ê–¶–ò–Ø

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|-------------|-----------|
| **–ü–æ—Ç–µ—Ä—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏** | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **SSE –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ proxy** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–∏–µ | –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **Performance –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–∏–µ | Load testing –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º |
| **Browser compatibility issues** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–∏–µ | –ö—Ä–æ—Å—Å-–±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **Redis Streams overflow** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–∏–µ | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ XTRIM –≤ SSE manager |

---

## üìÖ –í–†–ï–ú–ï–ù–ù–û–ô –ü–õ–ê–ù

| –§–∞–∑–∞ | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å | –ë–ª–æ–∫–µ—Ä—ã |
|------|-------------|----------------|---------|
| **Frontend Migration** | 2-3 –¥–Ω—è | –ú–æ–∂–µ—Ç –∏–¥—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å Backend | –ù–µ—Ç |
| **Backend Cleanup** | 2 –¥–Ω—è | –ú–æ–∂–µ—Ç –∏–¥—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å Frontend | –ù–µ—Ç |  
| **Infrastructure** | 1 –¥–µ–Ω—å | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç Backend | Backend –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å |
| **Testing** | 2-3 –¥–Ω—è | –ú–æ–∂–µ—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –ª—é–±–æ–π —Ñ–∞–∑—ã | Frontend + Backend |
| **Monitoring** | 1 –¥–µ–Ω—å | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å Testing | Backend –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å |
| **Documentation** | 1 –¥–µ–Ω—å | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –ª—é–±–æ–π —Ñ–∞–∑–æ–π | –ù–µ—Ç |

### üóìÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

**–î–µ–Ω—å 1-3:** Frontend + Backend (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)  
**–î–µ–Ω—å 4:** Infrastructure + –Ω–∞—á–∞–ª–æ Testing  
**–î–µ–Ω—å 5-7:** Testing + Monitoring + Documentation  
**–î–µ–Ω—å 8:** Final validation + Production deploy

**–ò–¢–û–ì–û: 8 –¥–Ω–µ–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥–æ 6 –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ**

---

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ó–ê–ü–£–°–ö–£

### ‚úÖ –ü—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:
- SSE —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ ‚úÖ
- Frontend –≥–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—é ‚úÖ  
- Redis –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—â–∞—è ‚úÖ
- Endpoints –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω—ã ‚úÖ

### üéØ Next Actions:
1. **–ù–∞–∑–Ω–∞—á–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö** –ø–æ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
2. **–°–æ–∑–¥–∞—Ç—å branch** `feature/websocket-to-sse-migration`
3. **–ù–∞—á–∞—Ç—å —Å Frontend Migration** (–Ω–∞–∏–º–µ–Ω—å—à–∏–π —Ä–∏—Å–∫)
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞** —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç —á–µ–∫-–ª–∏—Å—Ç

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –ò –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨

| –†–æ–ª—å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ |
|------|---------------|-----------|
| **Project Manager** | TBD | –û–±—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è |
| **Frontend Developer** | TBD | –ö–∞—Ç–µ–≥–æ—Ä–∏—è 1: Frontend Migration |
| **Backend Developer** | TBD | –ö–∞—Ç–µ–≥–æ—Ä–∏—è 2: Backend Cleanup |
| **DevOps Engineer** | TBD | –ö–∞—Ç–µ–≥–æ—Ä–∏—è 3: Infrastructure |
| **QA Engineer** | TBD | –ö–∞—Ç–µ–≥–æ—Ä–∏—è 4: Testing |
| **Tech Writer** | TBD | –ö–∞—Ç–µ–≥–æ—Ä–∏—è 6: Documentation |

---

---

## üéâ –ò–¢–û–ì–ò –ú–ò–ì–†–ê–¶–ò–ò

### ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1 –¥–µ–Ω—å (–≤–º–µ—Å—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö 8-10 –¥–Ω–µ–π)  
**–ü—Ä–∏—á–∏–Ω–∞ —É—Å–∫–æ—Ä–µ–Ω–∏—è:** SSE —Å–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ —É–∂–µ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  

### üìä –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—Ç–∞—Ç—É—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-----------|---------|-----------|
| **1. Frontend Migration** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | SSE –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, WebSocket –∫–æ–¥ —É–¥–∞–ª–µ–Ω |
| **2. Backend Cleanup** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | WebSocket manager —É–¥–∞–ª–µ–Ω, SSE wrapper —Å–æ–∑–¥–∞–Ω—ã |
| **3. Infrastructure** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | Nginx —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è SSE |
| **4. Testing & Validation** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | Backend/Frontend –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ |

### üéØ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò

- ‚úÖ **WebSocket –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ**
  - ‚úÖ –£–¥–∞–ª–µ–Ω `backend/api/websockets.py`
  - ‚úÖ –£–¥–∞–ª–µ–Ω—ã WebSocket –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `main.py`
  - ‚úÖ –°–æ–∑–¥–∞–Ω SSE compatibility layer

- ‚úÖ **–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç —Å–æ–±—ã—Ç–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ SSE**
  - ‚úÖ Frontend –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ EventSource
  - ‚úÖ SSE endpoints —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç
  - ‚úÖ Handoff logic —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ SSE

- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
  - ‚úÖ Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
  - ‚úÖ Frontend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
  - ‚úÖ Health checks –ø—Ä–æ—Ö–æ–¥—è—Ç
  - ‚úÖ Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

**Frontend (`chat-iframe.js`):**
- –£–¥–∞–ª–µ–Ω WebSocket state –∏ reconnection logic
- –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω SSE transport (`USE_SSE_TRANSPORT = true`)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è handoff —Å–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å
- EventSource –∑–∞–º–µ–Ω–∏–ª WebSocket connections

**Backend:**
- –£–¥–∞–ª–µ–Ω `backend/api/websockets.py`
- –°–æ–∑–¥–∞–Ω SSE compatibility layer –≤ `api/site.py`, `api/dialogs.py`, `api/bots.py`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è SSE
- WS-BRIDGE –æ—Ç–∫–ª—é—á–µ–Ω –≤ –ø–æ–ª—å–∑—É SSE

**Infrastructure:**
- `nginx-sse.conf` —É–∂–µ –±—ã–ª –≥–æ—Ç–æ–≤ –¥–ª—è SSE
- –£–¥–∞–ª–µ–Ω—ã WebSocket proxy headers
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Server-Sent Events

### üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–î–µ–ø–ª–æ–π –≤ staging** - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å handoff flow
3. **Production –¥–µ–ø–ª–æ–π** - –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å SSE –º–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** ‚úÖ MIGRATION COMPLETED  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-14  
**–í–µ—Ä—Å–∏—è:** 2.0 (Final)  

---

> üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:** WebSocket ‚Üí SSE –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ–ø–ª–æ—é!
