; üöÄ PGBOUNCER –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –î–õ–Ø CHATAI PRODUCTION
; –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø—É–ª–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è PostgreSQL

;; Database settings
[databases]
chat_ai = host=localhost port=5432 dbname=chat_ai user=chat_ai_app pool_size=25 max_db_connections=50

;; Connection pooling settings
[pgbouncer]
; –†–µ–∂–∏–º –ø—É–ª–∏–Ω–≥–∞ (transaction - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
pool_mode = transaction

; –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
listen_port = 6432
listen_addr = 127.0.0.1

; –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt
logfile = /var/log/pgbouncer/pgbouncer.log
pidfile = /var/run/pgbouncer/pgbouncer.pid

; === –ù–ê–°–¢–†–û–ô–ö–ò –ü–£–õ–ê –°–û–ï–î–ò–ù–ï–ù–ò–ô (PRODUCTION OPTIMIZED) ===

; –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
max_client_conn = 200

; –ü—É–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –±–∞–∑ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –≤ [databases])
default_pool_size = 25

; –†–µ–∑–µ—Ä–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
reserve_pool_size = 5

; –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑ –ø—É–ª–∞ (30 —Å–µ–∫)
reserve_pool_timeout = 30

; –í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è (10 –º–∏–Ω—É—Ç)
server_idle_timeout = 600

; –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (1 —á–∞—Å)
server_lifetime = 3600

; –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ë–î (15 —Å–µ–∫)
server_connect_timeout = 15

; –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤—Ö–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞ (60 —Å–µ–∫)
client_login_timeout = 60

; –ê–≤—Ç–æ–ª–æ–≥–∏–Ω –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
autodb_idle_timeout = 3600

; === –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ù–ê–î–Å–ñ–ù–û–°–¢–¨ ===

; –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å StartupMessage –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
ignore_startup_parameters = extra_float_digits

; –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –Ω–µ –ø–æ–∑–≤–æ–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º –∏–∑–º–µ–Ω—è—Ç—å —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
application_name_add_host = 1

; TCP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
tcp_keepalive = 1
tcp_keepcnt = 3
tcp_keepidle = 600
tcp_keepintvl = 30

; === –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –õ–û–ì–ò ===

; –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤ (0=—Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏, 1=–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, 2=info, 3=debug)
log_connections = 1
log_disconnections = 1  
log_pooler_errors = 1

; –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
syslog = 0
syslog_facility = daemon
syslog_ident = pgbouncer

; === –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ===

; –ë–∞–∑–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
admin_users = postgres,admin
stats_users = postgres,admin,monitoring

; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –∫–æ–Ω—Å–æ–ª–∏
; SHOW POOLS, SHOW DATABASES, RELOAD –∏ —Ç.–¥.
stats_period = 60

; === –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ ===

; –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –¥–ª—è –ø–∞–∫–µ—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4096)
pkt_buf = 8192

; –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ —Å–æ–∫–µ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0 = —Å–∏—Å—Ç–µ–º–Ω—ã–π)
sbuf_loopcnt = 5

; –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
max_packet_size = 2147483647

; === –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –î–õ–Ø CHATAI –ù–ê–°–¢–†–û–ô–ö–ò ===

; –î–ª—è FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å transaction pooling
; –ø–æ—Å–∫–æ–ª—å–∫—É –∫–∞–∂–¥—ã–π HTTP –∑–∞–ø—Ä–æ—Å = –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

; –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
; - pool_mode = transaction (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏)
; - default_pool_size = 25 (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –Ω–∞–≥—Ä—É–∑–æ–∫)
; - max_client_conn = 200 (–ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –¥–æ 200 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

; === MONITORING QUERIES ===
; –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ psql:
; psql -h 127.0.0.1 -p 6432 -U admin pgbouncer
; SHOW POOLS;
; SHOW DATABASES; 
; SHOW STATS;
; SHOW SERVERS;
; SHOW CLIENTS;

; === RELOAD CONFIGURATION ===
; –î–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è:
; psql -h 127.0.0.1 -p 6432 -U admin pgbouncer -c "RELOAD;"