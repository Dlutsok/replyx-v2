# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 05 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  

## –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º

–í —Ö–æ–¥–µ –∞–Ω–∞–ª–∏–∑–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã ReplyX –±—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ 2 –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±–æ–≤–∞–ª–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –£—Ç–µ—á–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ SITE_SECRET –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `SITE_SECRET` –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `frontend/.env.production`
- Frontend middleware –≤—ã–ø–æ–ª–Ω—è–ª JWT –≤–∞–ª–∏–¥–∞—Ü–∏—é –ª–æ–∫–∞–ª—å–Ω–æ —Å —Ä–∞—Å–∫—Ä—ã—Ç—ã–º —Å–µ–∫—Ä–µ—Ç–æ–º
- –°–µ—Ä—å–µ–∑–Ω–∞—è —É–≥—Ä–æ–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - –ª—é–±–æ–π –º–æ–∂–µ—Ç –∏–∑–≤–ª–µ—á—å —Å–µ–∫—Ä–µ—Ç –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω `SITE_SECRET` –∏–∑ `frontend/.env.production`
- ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω `frontend/middleware.js` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è backend API
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ backend-first –º–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 2. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è JWT –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Frontend middleware –ø—ã—Ç–∞–ª—Å—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ
- –û—à–∏–±–∫–∏ —Å crypto –º–æ–¥—É–ª–µ–º –≤ Edge Runtime
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤ —Å –ë–î

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ Frontend middleware —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ `${BACKEND_API_URL}/api/validate-widget-token`
- ‚úÖ –í—Å—è JWT –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º backend —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–º–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ –ë–î

### 3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–π `X-Frame-Options ALLOW-FROM` –≤ backend middleware
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–π `X-Frame-Options DENY` –≤ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ iframe –≤–∏–¥–∂–µ—Ç–æ–≤ –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–æ–º–µ–Ω–∞—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `X-Frame-Options` –∏–∑ `backend/core/dynamic_csp_middleware.py`
- ‚úÖ –£–¥–∞–ª–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–π `X-Frame-Options DENY` –∏–∑ `Deployed/nginx/nginx.conf`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π CSP `frame-ancestors`

## üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 4. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –≤ Workers

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Workers –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ `localhost:8000` –∞–¥—Ä–µ—Å–∞
- –ù–µ —Ä–∞–±–æ—Ç–∞–ª–æ –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –º–æ–≥–ª–∏ –æ–±—â–∞—Ç—å—Å—è)
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å backend URL

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `BACKEND_API_URL` –≤ workers –∫–æ–¥
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ URL –Ω–∞ `${BACKEND_API_URL}`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `Deployed/.env.production`: `BACKEND_API_URL=http://backend:8000`

### 5. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å env —Ñ–∞–π–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ env —Ñ–∞–π–ª—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞
- –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å—Ä–µ–¥–∞–º–∏
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ 2 env —Ñ–∞–π–ª–∞: `.env` (dev) –∏ `Deployed/.env.production` (prod)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `BACKEND_API_URL=http://localhost:8000` –≤ –æ—Å–Ω–æ–≤–Ω–æ–π `.env`
- ‚úÖ –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∏ –¥–≤–∞ —Ñ–∞–π–ª–∞

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Backend-First –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    HTTP POST     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    JWT + DB      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Frontend        ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ Backend API      ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ PostgreSQL  ‚îÇ
‚îÇ middleware.js   ‚îÇ                  ‚îÇ /validate-token  ‚îÇ                  ‚îÇ Database    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                             ‚îÇ
                                             ‚ñº
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ Dynamic CSP      ‚îÇ
                                    ‚îÇ Generation       ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ù–æ–≤—ã–π –ø–æ—Ç–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤

1. **Frontend Middleware** –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `/chat-iframe?site_token=...`
2. **HTTP –∑–∞–ø—Ä–æ—Å** –∫ `${BACKEND_API_URL}/api/validate-widget-token`
3. **Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT + –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –ë–î
4. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π CSP**: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `frame-ancestors` –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
5. **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç**: CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- `frontend/.env.production` - —É–¥–∞–ª–µ–Ω SITE_SECRET
- `frontend/middleware.js` - –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è backend API –≤—ã–∑–æ–≤–æ–≤
- `backend/core/dynamic_csp_middleware.py` - —É–¥–∞–ª–µ–Ω X-Frame-Options
- `Deployed/nginx/nginx.conf` - —É–¥–∞–ª–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–π X-Frame-Options DENY

### üõ†Ô∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞  
- `workers/telegram/bot_worker.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ BACKEND_API_URL
- `workers/master/scalable_bot_manager.js` - –∑–∞–º–µ–Ω–∞ localhost –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
- `Deployed/.env.production` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω BACKEND_API_URL=http://backend:8000
- `.env` - –¥–æ–±–∞–≤–ª–µ–Ω BACKEND_API_URL=http://localhost:8000

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# Middleware —Ä–∞–±–æ—Ç–∞–µ—Ç —Å backend API
curl "http://localhost:3000/chat-iframe?site_token=test" -I
# HTTP/1.1 200 OK
# content-security-policy: frame-ancestors 'self'; ...
```

### ‚úÖ Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
```bash
# Environment –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
Development: BACKEND_API_URL=http://localhost:8000
Production:  BACKEND_API_URL=http://backend:8000
```

### ‚úÖ Workers –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```bash
# –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–∏—Ç–∞–µ—Ç—Å—è
BACKEND_API_URL=http://localhost:8000 node -e "console.log(process.env.BACKEND_API_URL)"
# –í—ã–≤–æ–¥: http://localhost:8000
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É–∫—Ä–µ–ø–ª–µ–Ω–∞
- ‚ùå –°–µ–∫—Ä–µ—Ç—ã –±–æ–ª—å—à–µ –Ω–µ —É—Ç–µ–∫–∞—é—Ç –≤ –±—Ä–∞—É–∑–µ—Ä
- ‚úÖ –í—Å—è JWT –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ë–î
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞  
- ‚úÖ Workers –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ backend –≤ –ª—é–±–æ–π —Å—Ä–µ–¥–µ
- ‚úÖ –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ env –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (2 —Ñ–∞–π–ª–∞)
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—â–∞—é—Ç—Å—è –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏
- ‚úÖ Nginx –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ iframe –∑–∞–ø—Ä–æ—Å—ã

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–∏–¥–∂–µ—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏

### Forward —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å  
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚úÖ –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- `frontend/middleware.js` –ª–æ–≥–∏: —É—Å–ø–µ—à–Ω–æ—Å—Ç—å backend API –≤—ã–∑–æ–≤–æ–≤
- `backend/api/validate-widget-token` –º–µ—Ç—Ä–∏–∫–∏: –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- CSP –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö: –¥–æ–ª–∂–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- Workers –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ 502/503 –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ backend

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### –ü–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Production
1. –û–±–Ω–æ–≤–∏—Ç—å `Deployed/.env.production` —Å –Ω–æ–≤—ã–º `BACKEND_API_URL`
2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å rolling update –Ω–∞—á–∏–Ω–∞—è —Å backend
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ç—Ä–∞—Ñ–∏–∫–µ
5. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è
- ‚úÖ Backend API `/api/validate-widget-token` –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ Frontend middleware —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ backend  
- ‚úÖ CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Workers –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ `http://backend:8000`
- ‚úÖ Nginx –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç iframe –∑–∞–ø—Ä–æ—Å—ã

---

**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã ‚úÖ  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** –î–∞ ‚úÖ  
**–¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–∫–∞—Ç:** –ù–µ—Ç ‚ùå