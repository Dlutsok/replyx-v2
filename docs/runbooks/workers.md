# Node.js Workers - –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

ChatAI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram –±–æ—Ç–∞–º–∏:

- **Master Process** (`master/scalable_bot_manager.js`) - —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å
- **Worker Processes** (`telegram/bot_worker.js`) - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–æ–≤
- **Webhook Server** (`services/webhook_server.js`) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- **Configuration** (`config/webhook.js`) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**: –∫–∞–∂–¥—ã–π –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
- **Graceful shutdown**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏ SIGTERM/SIGINT
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥—É–±–ª–µ–π
- **Rate limiting –æ—Ç–∫–ª—é—á–µ–Ω**: –ø—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ node-telegram-bot-api
- **Hot reload**: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞
- **Heartbeat –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–æ–≤ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- **Zombie process cleanup**: –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- **Handoff —Å–∏—Å—Ç–µ–º–∞**: –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º
- **–î–≤—É—Ö—Ä–µ–∂–∏–º–Ω—ã–π –∑–∞–ø—É—Å–∫**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ polling –∏ webhook

### üöß –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
- **Idempotency**: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á
- **Queue management**: –Ω–µ—Ç —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π
- **Retry logic**: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff
- **DLQ (Dead Letter Queue)**: –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–∞–¥–∞—á
- **Metrics collection**: –±–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑ Prometheus –º–µ—Ç—Ä–∏–∫

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Environment Variables

```bash
# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
BOT_MODE=polling                    # –∏–ª–∏ 'webhook' –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
NODE_ENV=development               # –∏–ª–∏ 'production'

# Webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
WEBHOOK_HOST=https://yourdomain.com
WEBHOOK_PORT=8443
WEBHOOK_SECRET=your-secret-token
WEBHOOK_SSL_CERT=/path/to/cert.pem
WEBHOOK_SSL_KEY=/path/to/private.key

# Telegram —Ç–æ–∫–µ–Ω—ã (—É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ API)
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ bot-instances API

# –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
AUTO_SWITCH_MODE=true
```

### Package.json Scripts

```json
{
  "start": "node master/scalable_bot_manager.js start",
  "stop": "node master/scalable_bot_manager.js stop", 
  "restart": "node master/scalable_bot_manager.js restart",
  "status": "node master/scalable_bot_manager.js status",
  "logs": "node master/scalable_bot_manager.js logs"
}
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

### –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
cd workers/
npm start
```

Master –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –û—á–∏—â–∞–µ—Ç zombie –ø—Ä–æ—Ü–µ—Å—Å—ã
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–æ—Ç–æ–≤ –∏–∑ API
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤–æ—Ä–∫–µ—Ä—ã –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Ç–æ–≤
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç webhook —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ webhook —Ä–µ–∂–∏–º)

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã

```bash
npm stop
# –∏–ª–∏
kill -TERM <master_pid>
```

Graceful shutdown sequence:
1. –ü—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏–µ–º–∞ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
2. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (timeout 90s)
3. –ó–∞–∫—Ä—ã—Ç–∏–µ IPC –∫–∞–Ω–∞–ª–æ–≤
4. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞
5. –í—ã—Ö–æ–¥ —Å –∫–æ–¥–æ–º 0

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
npm restart
# –∏–ª–∏
kill -USR2 <master_pid>  # Hot restart —Å–∏–≥–Ω–∞–ª
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞

```bash
npm run status
```

## –õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### Resource Limits
- **–ú–∞–∫—Å–∏–º—É–º –≤–æ—Ä–∫–µ—Ä–æ–≤**: 1000 (config.maxTotalWorkers)
- **–í–æ—Ä–∫–µ—Ä–æ–≤ –Ω–∞ —è–¥—Ä–æ**: 20 (config.maxWorkersPerCore)  
- **–ü–∞–º—è—Ç—å –Ω–∞ –≤–æ—Ä–∫–µ—Ä**: 150MB (config.maxMemoryPerWorker)
- **–¢–∞–π–º–∞—É—Ç –≤–æ—Ä–∫–µ—Ä–∞**: 90s (config.workerTimeout)

### Process Management
- **Heartbeat –∏–Ω—Ç–µ—Ä–≤–∞–ª**: 45s (—É–≤–µ–ª–∏—á–µ–Ω –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
- **Cooldown –ø–µ—Ä–∏–æ–¥**: 45s –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- **–ú–∞–∫—Å–∏–º—É–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤**: 5 –≤ —á–∞—Å –Ω–∞ –±–æ—Ç
- **Zombie cleanup**: –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å—Ç–∞—Ä—Ç–µ master –ø—Ä–æ—Ü–µ—Å—Å–∞

### Telegram API
- **Rate limiting**: –æ—Ç–∫–ª—é—á–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
- **–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞**: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç, –º–∞–∫—Å 10000 –∑–∞–ø–∏—Å–µ–π

## –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**Throttled logging** - —É–º–Ω–æ–µ –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ—à–∏–±–æ–∫:
- –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–µ–π –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
- –°–≤–æ–¥–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã—Ö

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**:
- `info` - –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `warn` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è, 409 –æ—à–∏–±–∫–∏)
- `error` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –≤–æ—Ä–∫–µ—Ä–∞

–ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
```javascript
{
  messages: 0,        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  errors: 0,          // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
  restarts: 0,        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤
  uptime: 0          // –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
}
```

### Health Endpoints

```bash
# Master –ø—Ä–æ—Ü–µ—Å—Å —Å—Ç–∞—Ç—É—Å
GET http://localhost:3001/api/workers/status

# Webhook —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ webhook —Ä–µ–∂–∏–º)
GET http://localhost:8443/health
GET http://localhost:8443/webhook/stats
```

## Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**409 Conflict –æ—à–∏–±–∫–∏**
- –ü—Ä–∏—á–∏–Ω–∞: –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ polling –Ω–∞ –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å zombie –ø—Ä–æ—Ü–µ—Å—Å—ã, —É–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏

**–ó–∞–≤–∏—Å—à–∏–µ –≤–æ—Ä–∫–µ—Ä—ã**  
- –ü—Ä–∏–∑–Ω–∞–∫–∏: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ heartbeat > 5 –º–∏–Ω—É—Ç
- –†–µ—à–µ–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

**–£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ê–≤—Ç–æ–¥–µ–π—Å—Ç–≤–∏–µ: –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 150MB
- –û—á–∏—Å—Ç–∫–∞: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep "bot_worker\|scalable_bot_manager"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤ webhook
netstat -tlnp | grep 8443

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
pgrep -f bot_worker | xargs -I {} sh -c 'echo "PID: {} MEM: $(ps -p {} -o rss --no-headers)KB"'

# –õ–æ–≥–∏ master –ø—Ä–æ—Ü–µ—Å—Å–∞
tail -f workers/logs/master.log

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞
tail -f workers/logs/worker_<botId>.log
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Secrets Management
- **–¢–æ–∫–µ–Ω—ã –±–æ—Ç–æ–≤**: –ø–æ–ª—É—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ API, –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ
- **Webhook secret**: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
- **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**: –ø—É—Ç–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ ENV

### –ó–∞—â–∏—Ç–∞ webhook
- –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram IP (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è)
- Secret token –ø—Ä–æ–≤–µ—Ä–∫–∞
- Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ nginx/load balancer

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ù–ï –ª–æ–≥–∏—Ä—É—é—Ç—Å—è**: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–õ–æ–≥–∏—Ä—É—é—Ç—Å—è**: —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏ –¥–∏–∞–ª–æ–≥–æ–≤, —Ä–∞–∑–º–µ—Ä—ã, —Å—Ç–∞—Ç—É—Å—ã

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –®–∞—Ä–¥–∏–Ω–≥ –ø–æ botId —á–µ—Ä–µ–∑ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- Sticky routing —á–µ—Ä–µ–∑ load balancer
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã master –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### Vertical Scaling
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ `maxWorkersPerCore` –¥–æ 25-30
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ `maxTotalWorkers` –¥–æ 2000+
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ CPU/Memory

## CI/CD

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# Smoke test
node master/scalable_bot_manager.js --dry-run

# Unit —Ç–µ—Å—Ç—ã –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
npm test

# E2E —Ç–µ—Å—Ç —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–æ–π
npm run test:e2e
```

### Deployment
1. Graceful shutdown —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (--dry-run)
4. –ó–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
5. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è health endpoints

## –ü–ª–∞–Ω—ã –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 - –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å idempotency keys –¥–ª—è –∑–∞–¥–∞—á
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry logic —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
- [ ] –°–æ–∑–¥–∞—Ç—å DLQ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–∞–¥–∞—á
- [ ] –§–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—á–µ—Ä–µ–¥–µ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 - –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å  
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus –¥–ª—è –º–µ—Ç—Ä–∏–∫
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ Grafana –¥–∞—à–±–æ—Ä–¥–æ–≤
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è
- [ ] –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (correlation ID)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è heartbeat –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
- [ ] –ü—É–ª–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –ë–î
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- [ ] Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å workers —Å–∏—Å—Ç–µ–º–æ–π:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoints
2. –ò–∑—É—á–∏—Ç—å –ª–æ–≥–∏ –≤ workers/logs/
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
4. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
