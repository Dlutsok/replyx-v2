# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¢-–ë–∞–Ω–∫ –¥–æ integration.js

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. Frontend –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### `frontend/pages/_app.tsx`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç `https://integrationjs.tbank.ru/integration.js`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `onPaymentIntegrationLoad()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã TypeScript —Ç–∏–ø—ã –¥–ª—è PaymentIntegration

#### `frontend/pages/balance.js`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö –≤–∏–¥–∂–µ—Ç–æ–≤ –æ–ø–ª–∞—Ç—ã (tpay, sbp, bnpl)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ `handleRechargeWithWidgets()` 
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∏–¥–∂–µ—Ç–æ–≤ —Å refs
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω fallback –∫ —Å—Ç–∞—Ä–æ–º—É –º–µ—Ç–æ–¥—É –æ–ø–ª–∞—Ç—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

### 2. Backend –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### `backend/api/tinkoff_payments.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π endpoint `/api/payments/create-payment-data`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ Pydantic –º–æ–¥–µ–ª—å `CreatePaymentDataRequest`
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∏–¥–∂–µ—Ç–æ–≤ –≤–º–µ—Å—Ç–æ HTML —Ñ–æ—Ä–º
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω —Å—Ç–∞—Ä—ã–π endpoint –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (CSP)

#### `backend/core/security_headers.py`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã CSP –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¢-–ë–∞–Ω–∫ –¥–æ–º–µ–Ω–æ–≤:
  - `https://*.tbank.ru`
  - `https://*.tinkoff.ru` 
  - `https://*.tcsbank.ru`
  - `https://*.nspk.ru`
  - `https://*.t-static.ru`

#### `frontend/next.config.js`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è development –∏ production

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### `.env`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `NEXT_PUBLIC_TINKOFF_TERMINAL_KEY=1757348842151DEMO`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¢–∏–Ω—å–∫–æ—Ñ—Ñ

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –í–∏–¥–∂–µ—Ç—ã –±—ã—Å—Ç—Ä–æ–π –æ–ø–ª–∞—Ç—ã
- **T-Pay** - –±—ã—Å—Ç—Ä–∞—è –æ–ø–ª–∞—Ç–∞ –¢-–ë–∞–Ω–∫
- **–°–ë–ü** - —Å–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- **BNPL** - –æ–ø–ª–∞—Ç–∞ –¥–æ–ª—è–º–∏

### 2. –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞
- –í–∏–¥–∂–µ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–∞–ª–∞–Ω—Å–∞
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UX —Å –≤—ã–±–æ—Ä–æ–º —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

### 3. Fallback –º–µ—Ö–∞–Ω–∏–∑–º
- –ï—Å–ª–∏ –Ω–æ–≤—ã–µ –≤–∏–¥–∂–µ—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å Python –∫–æ–¥–∞
- ‚úÖ –°–±–æ—Ä–∫–∞ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CSP –ø–æ–ª–∏—Ç–∏–∫
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ integration.js –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PaymentIntegration
- üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–æ–≤ –æ–ø–ª–∞—Ç—ã
- üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã end-to-end

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `NEXT_PUBLIC_TINKOFF_TERMINAL_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ frontend –∏ backend
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/balance`
4. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å" - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –≤–∏–¥–∂–µ—Ç—ã

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö —Ç—Ä–µ—Ö –≤–∏–¥–∂–µ—Ç–æ–≤: T-Pay, –°–ë–ü, BNPL
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –µ—Å–ª–∏ –≤–∏–¥–∂–µ—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

## –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `https://integrationjs.tbank.ru/integration.js`
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `PaymentIntegration.init()`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–∂–µ—Ç–æ–≤ –æ–ø–ª–∞—Ç—ã
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ CSP –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ–±—É–µ–º—ã—Ö –¥–æ–º–µ–Ω–æ–≤

### ‚ö†Ô∏è –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏:
- Iframe –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã (sberpay, mirpay) - –∑–∞–≤–∏—Å—è—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: CSP –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ –¥–æ–º–µ–Ω—ã –≤ CSP –ø–æ–ª–∏—Ç–∏–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π  
**–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω fallback –º–µ—Ö–∞–Ω–∏–∑–º

### –ü—Ä–æ–±–ª–µ–º–∞: TypeScript —Ç–∏–ø—ã –¥–ª—è PaymentIntegration
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–∏ –≤ _app.tsx

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏ —Ä–∞–±–æ—Ç—É –≤–∏–¥–∂–µ—Ç–æ–≤
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞** - –≤–∫–ª—é—á–∏—Ç—å –Ω—É–∂–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –≤ –õ–ö –¢-–ë–∞–Ω–∫
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---
*–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –¢-–ë–∞–Ω–∫ Integration.js v1.0*