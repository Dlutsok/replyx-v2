# ReplyX Workers - Environment Configuration Template

# === CORE SETTINGS ===
NODE_ENV=development                    # development, production, test
BOT_MODE=polling                        # polling, webhook

# === DATABASE ===
DATABASE_URL=postgresql://user:pass@localhost:5432/replyx
REDIS_URL=redis://localhost:6379

# === WEBHOOK CONFIGURATION (Production only) ===
WEBHOOK_HOST=https://yourdomain.com     # Public HTTPS URL
WEBHOOK_PORT=8443                       # Webhook server port
WEBHOOK_SECRET=your-webhook-secret      # Secret token for validation
WEBHOOK_SSL_CERT=/path/to/cert.pem     # SSL certificate path
WEBHOOK_SSL_KEY=/path/to/private.key   # SSL private key path
WEBHOOK_MAX_CONNECTIONS=40             # Max concurrent connections
AUTO_SWITCH_MODE=true                  # Auto switch between polling/webhook

# === WORKER LIMITS ===
WORKER_MAX_TOTAL=1000                  # Maximum total workers
WORKER_MAX_PER_CORE=20                 # Workers per CPU core  
WORKER_MEMORY_LIMIT=157286400          # 150MB per worker
WORKER_TIMEOUT=90000                   # Worker timeout (90s)
WORKER_CONCURRENCY=8                   # Concurrent operations per worker

# === PROCESS MANAGEMENT ===
HEARTBEAT_INTERVAL=45000               # Heartbeat check interval (45s)
COOLDOWN_PERIOD=45000                  # Cooldown between restarts (45s)
MAX_RESTART_RATE=5                     # Max restarts per hour per bot
ZOMBIE_CLEANUP_ON_START=true           # Clean zombie processes on startup
GRACEFUL_SHUTDOWN_TIMEOUT=90000        # Graceful shutdown timeout

# === TELEGRAM API ===
TELEGRAM_RATE_GLOBAL_RPS=30            # Global rate limit (requests/sec)
TELEGRAM_RATE_CHAT_RPS=1               # Per-chat rate limit
TELEGRAM_RATE_BURST_SIZE=5             # Burst size for spikes
TELEGRAM_MAX_RETRIES=3                 # Max retries for failed requests
TELEGRAM_RETRY_BASE_DELAY=1000         # Base delay for retries (ms)
TELEGRAM_RETRY_MAX_DELAY=30000         # Max delay for retries (ms)

# === LOGGING ===
LOG_LEVEL=info                         # error, warn, info, debug
LOG_THROTTLE_INTERVAL=30000            # Log throttling interval (30s)
LOG_RETENTION=500                      # Max log entries per worker
LOG_SUMMARY_INTERVAL=60000             # Log summary interval (1min)

# === QUEUE SYSTEM (Future implementation) ===
QUEUE_WORKER_CONCURRENCY=10            # Queue worker concurrency
QUEUE_MAX_JOB_ATTEMPTS=5               # Max retry attempts per job
QUEUE_RETRY_BASE_DELAY=1000            # Base delay for job retries
QUEUE_RETRY_MAX_DELAY=30000            # Max delay for job retries
QUEUE_DLQ_MAX_SIZE=10000               # Dead letter queue max size
REDIS_QUEUE_PREFIX=replyx:queue        # Redis key prefix for queues
REDIS_DLQ_PREFIX=replyx:dlq            # Redis key prefix for DLQ
REDIS_IDEMPOTENCY_TTL=3600             # Idempotency key TTL (1 hour)

# === MONITORING ===
METRICS_ENABLED=true                   # Enable metrics collection
METRICS_INTERVAL=30000                 # Metrics collection interval
PROMETHEUS_PORT=9090                   # Prometheus metrics port
HEALTH_CHECK_PORT=3001                 # Health check endpoint port
MONITORING_INTERVAL=45000              # System monitoring interval

# === SECURITY ===
VALIDATE_TELEGRAM_IP=false             # Validate Telegram server IPs
RATE_LIMIT_ENABLED=false               # Enable rate limiting (currently disabled)
LOG_PERSONAL_DATA=false                # Log personal data (disabled for privacy)
SECRET_ROTATION_ENABLED=false          # Enable automatic secret rotation

# === DEVELOPMENT ===
DEBUG_MODE=false                       # Enable debug logging
HOT_RELOAD_ENABLED=true                # Enable hot reload for settings
DRY_RUN=false                          # Dry run mode (no actual operations)
SIMULATE_ERRORS=false                  # Simulate errors for testing

# === PERFORMANCE ===
GC_INTERVAL=600000                     # Garbage collection interval (10min)
MEMORY_CHECK_INTERVAL=300000           # Memory check interval (5min)
EMERGENCY_STOP_THRESHOLD=0.95          # Emergency stop at 95% resource usage
STALE_WORKER_TIMEOUT=300000            # Stale worker cleanup timeout (5min)

# === API ENDPOINTS ===
BACKEND_API_URL=http://127.0.0.1:8000  # Backend API base URL
API_TIMEOUT=30000                      # API request timeout
API_RETRY_ATTEMPTS=3                   # API retry attempts

# === WEBHOOK SECURITY ===
WEBHOOK_IP_WHITELIST=""                # Comma-separated IP whitelist
WEBHOOK_RATE_LIMIT=1000                # Webhook rate limit per IP
WEBHOOK_TIMEOUT=30000                  # Webhook request timeout

# === CLUSTERING (Future) ===
CLUSTER_ENABLED=false                  # Enable clustering
CLUSTER_SHARD_TOTAL=4                  # Total number of shards
CLUSTER_SHARD_INDEX=0                  # Current shard index
CLUSTER_DISCOVERY_URL=""               # Cluster discovery endpoint

# === ALERTS ===
ALERT_WEBHOOK_URL=""                   # Webhook URL for alerts
ALERT_EMAIL_ENABLED=false              # Enable email alerts
ALERT_SLACK_WEBHOOK=""                 # Slack webhook for alerts
ALERT_COOLDOWN=300000                  # Alert cooldown period (5min)